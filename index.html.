<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAHIGAN SHOPFY - Mobile App</title>
    <style>
        /* =======================================================
           1. CSS-ta Guud iyo Qaabka Mobile-ka (BASE STYLES)
           ======================================================= */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            background-color: #f0f0f0; 
            color: #333;
        }
        .container {
            max-width: 4200px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh; 
        }
        
        /* Header & Logo */
        .header {
            display: flex;
            align-items: center;
            padding: 10px 0 15px 0;
            border-bottom: 1px solid #eee;
        }
        .app-logo {
            /* LOGO URL Cusub */
            width: 50px; 
            height: 50px;
            object-fit: contain; 
            border-radius: 5px; 
            margin-right: 10px;
        }
        .app-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #17a2b8; 
        }
        
        h2 {
            color: #28a745;
            padding-bottom: 5px;
            margin-top: 20px;
        }
        
        /* Badhamada */
        .checkout-btn {
            width: 100%;
            background-color: #28a745;
            color: white;
            border: none;
            padding: 15px 0;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .back-btn {
            background-color: #6c757d;
            margin-top: 15px;
        }

        /* Liiska Alaabta */
        .product-img {
            width: 80px; 
            height: 80px; 
            object-fit: cover; 
            border-radius: 8px; 
            margin-right: 15px;
        }
        .product-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        .item-info-wrapper {
             display: flex;
             align-items: center;
        }
        .add-to-cart-btn {
            color: white;
            background-color: #28a745;
            border: none;
            padding: 8px 12px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            min-width: 40px; 
            min-height: 40px;
        }
        
        /* Cart Styles */
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dotted #ccc;
        }
        
        /* Checkout Bar */
        .checkout-bar {
            position: fixed; 
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 10px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 420px; 
            margin: 0 auto;
        }

        /* =======================================================
           2. LOGIN/LANDING PAGE STYLES (Centering)
           ======================================================= */
        #login-landing-section, #login-section {
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            min-height: 90vh; 
            text-align: center;
        }
        
        #login-section {
            display: none; 
            min-height: 90vh;
        }

        .landing-logo {
            /* LOGO URL Cusub */
            width: 150px; 
            height: 150px; 
            object-fit: contain;
            border-radius: 15px; 
            margin-bottom: 20px;
        }

        .landing-title {
            color: #28a745; 
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Foomamka */
        .payment-method {
            width: 100%;
            max-width: 350px;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #fff;
            box-sizing: border-box;
        }
        .input-group {
            width: 100%; 
            margin-bottom: 15px;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .input-row {
            display: flex;
            gap: 10px;
        }

        /* =======================================================
           3. HAGAAGJINTA MODAL/ALERT BADHAMADA
           ======================================================= */
        .modal-overlay {
            /* Waxaan hubinayaa in Alert-ku uu dhexda ku yaal */
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.6); 
            z-index: 10000; 
            display: flex; /* Muhiim: wuxuu u ogolaanayaa in content-ku dhexda galo */
            justify-content: center; 
            align-items: center;
        }
        .modal-content {
            background-color: white; 
            padding: 25px; 
            border-radius: 10px; 
            width: 80%; 
            max-width: 350px; 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); 
            text-align: center;
        }
        .modal-actions {
            /* Hubinta in OK button-ku midigta ku dhaco */
            display: flex;
            justify-content: flex-end; 
            margin-top: 15px;
        }
        .modal-ok-btn {
            background-color: #28a745; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold;
            margin-left: 10px; 
        }
        .modal-main-btn {
            width: 100%; 
            padding: 10px 0; 
            margin-top: 10px; 
            border-radius: 5px; 
            border: none;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }
        
    </style>
</head>
<body>

<div class="container">
    
    <div class="header" id="app-header" style="display: none;">
        <img src="https://i.ibb.co/DfkN8MZ9/file-00000000fbbc7243911c5a18cc52df9b.png" alt="MAHIGAN Logo" class="app-logo"> 
        <span class="app-title">MAHIGAN SHOPFY</span> 
    </div>

    <div id="login-landing-section">
        <img src="https://i.ibb.co/DfkN8MZ9/file-00000000fbbc7243911c5a18cc52df9b.png" alt="Welcome MAHIGAN SHOPFY Logo" class="landing-logo">

        <h1 class="landing-title">Ku Soo Dhawoow MAHIGAN SHOPFY</h1>
        <p>Dalbo Cuntadaada Caawo adigoo Hal Mar Gujinaya!</p>
        
        <div class="login-btn-group" style="width: 80%; max-width: 300px;">
            <button id="login-button" class="checkout-btn" onclick="showLogin(true)">Geli (Login)</button>
            <button id="signup-button" class="checkout-btn" style="background-color: #007bff; margin-top: 10px;" onclick="showLogin(false)">Diiwaangeli (Signup)</button>
        </div>
    </div>
    
    <div id="login-section">
        <h2 id="login-title">Geli App-ka</h2>
        
        <div class="payment-method">
            <form>
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Tusaale@gmail.com" required>
                </div>
                
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="ugu yaraan 6 xaraf" required>
                </div>

                <div class="input-group" id="confirm-password-group" style="display: none;">
                    <label for="confirm-password">Xaqiiji Password-ka</label>
                    <input type="password" id="confirm-password" placeholder="ugu yaraan 6 xaraf" required>
                </div>
                
                <button type="button" class="checkout-btn" id="submit-login-btn" onclick="processAuth()">Geli App-ka</button>
            </form>
            
            <p class="toggle-text" id="toggle-auth-text" style="margin-top: 15px;">
                Ma haysaa Account? <span class="toggle-link" style="color: #28a745; cursor: pointer; font-weight: bold;" onclick="toggleAuth(false)">Diiwaangeli Hadda</span>
            </p>
        </div>
        <button class="checkout-btn back-btn" style="width: 80%; max-width: 350px;" onclick="showLanding()">‚Üê Dib U Noqo</button>
    </div>

    <div id="menu-section" style="display: none; padding-bottom: 90px;">
        
        <h2>üçΩÔ∏è Liiska Cuntada</h2>

        <div class="product-item">
            <div class="item-info-wrapper">
                <img src="https://i.ibb.co/YBX11ywM/file-0000000041f0720cb4e87b565664aa64.png" alt="Salad" class="product-img"> 
                <div class="item-info">
                    <h3>Salad</h3>
                    <span class="price">$3.50</span>
                </div>
            </div>
            <button class="add-to-cart-btn" data-product-name="Salad" data-price="3.50">+</button>
        </div>

        <div class="product-item">
            <div class="item-info-wrapper">
                <img src="https://i.ibb.co/8nhQH3FD/file-0000000059cc71f5a777ee4398602247.png" alt="Burger" class="product-img"> 
                <div class="item-info">
                    <h3>Burger</h3>
                    <span class="price">$10.50</span>
                </div>
            </div>
            <button class="add-to-cart-btn" data-product-name="Burger" data-price="10.50">+</button>
        </div>
        
        <div class="product-item">
            <div class="item-info-wrapper">
                <img src="https://i.ibb.co/Vcq79hnL/file-00000000a1e071f5b92d3778820e7024.png" alt="Pizza" class="product-img"> 
                <div class="item-info">
                    <h3>Pizza Slice</h3>
                    <span class="price">$20.50</span>
                </div>
            </div>
            <button class="add-to-cart-btn" data-product-name="Pizza Slice" data-price="20.50">+</button>
        </div>

        <div class="product-item">
            <div class="item-info-wrapper">
                <img src="https://i.ibb.co/rftsYWkX/file-00000000a808720abf28c6c2bda0951e.png" alt="Milkshake" class="product-img"> 
                <div class="item-info">
                    <h3>Milkshake</h3>
                    <span class="price">$7.50</span>
                </div>
            </div>
            <button class="add-to-cart-btn" data-product-name="Milkshake" data-price="7.50">+</button>
        </div>

        <div class="product-item">
            <div class="item-info-wrapper">
                <img src="https://i.ibb.co/bjtjjb3d/file-00000000f14c720a9525503de03f0617.png" alt="Coffee" class="product-img"> 
                <div class="item-info">
                    <h3>Coffee</h3>
                    <span class="price">$4.00</span>
                </div>
            </div>
            <button class="add-to-cart-btn" data-product-name="Coffee" data-price="4.00">+</button>
        </div>

        <hr>

        <h2>üõí Gacanta Alaabtaada</h2>
        <div id="cart-items">
            <p style="color: #777;">Wali maadan dooran wax alaab ah.</p>
        </div>

        <div class="cart-summary" style="font-size: 1.2em; font-weight: bold; margin-top: 15px; text-align: right;">
            Wadarta Guud: <span id="total-price">$0.00</span>
        </div>
    </div>
    
    <div id="payment-section" style="display: none; padding-bottom: 90px;">
        
        <button class="checkout-btn back-btn" onclick="showMenu()">‚Üê Dib U Noqo Liiska Cuntada</button>
        
        <h2>üíµ Bixinta Tooska ah</h2>
        
        <div class="total-display" style="text-align: right; font-size: 1.5em; font-weight: bold; margin-bottom: 20px; padding: 10px; border-bottom: 2px solid #28a745;">
            Wadarta Guud: <span id="final-total">$0.00</span>
        </div>
        
        
        <div class="payment-method">
            <h3>üí≥ Card Payment (Tijaabo)</h3>
            
            <button type="button" class="checkout-btn" style="background-color: #007bff; margin-bottom: 15px;" onclick="fillCardDetails()">
                Buuxi Card-kayga La Kaydiyay (Simulation)
            </button>

            <form>
                <div class="input-group">
                    <label for="card-number">Nambarka Card-ka</label>
                    <input type="text" id="card-number" placeholder="XXXX XXXX XXXX XXXX">
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label for="expiry-date">Taariikhda Dhicidda</label>
                        <input type="text" id="expiry-date" placeholder="MM/YY">
                    </div>
                    <div class="input-group">
                        <label for="cvv">CVV</label>
                        <input type="text" id="cvv" placeholder="123">
                    </div>
                </div>

                <div class="input-group">
                    <label for="card-name">Magaca Card-ka ku Qoran</label>
                    <input type="text" id="card-name">
                </div>
            </form>
        </div>
        
        
        <div class="payment-method">
            <h3>üì± Mobile Money/Number</h3>
            <form>
                 <div class="input-group">
                    <label for="mobile-provider">Adeegga Mobile-ka</label>
                    <select id="mobile-provider">
                        <option value="">Dooro Adeegga...</option>
                        <option value="Zaad">Zaad Service</option>
                        <option value="E-Dahab">E-Dahab</option>
                        <option value="Adeeg Kale">Adeeg Kale</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="sender-mobile-number">Nambarka Lacagta Laga Soo Diray</label>
                    <input type="tel" id="sender-mobile-number" placeholder="6X XXXXXXX">
                </div>
                
                <div class="input-group">
                    <label for="sender-name">Magaca Account-ka (Wixii ku Qoran)</label>
                    <input type="text" id="sender-name" placeholder="Tusaale: Maxamed Cali">
                </div>
            </form>
        </div>
        
    </div>

</div> <div id="custom-alert" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3 id="alert-title" style="color: #dc3545; margin-top: 0; font-size: 1.2em;">üö´ Digniin!</h3>
        <div id="alert-message">Fadlan, ugu yaraan hal alaab ku dar gacanta alaabta ka hor inta aadan checkout samayn!</div>
        
        <div id="receipt-details-container" style="display: none; text-align: left; background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px; border: 2px solid #28a745;">
            <p style="text-align: center; font-weight: bold; color: #28a745;">RASIIDKA DALABKAAGA</p>
            <hr style="border-top: 1px dotted #ccc;">
            <div id="receipt-items-list" style="margin-bottom: 10px;"></div>
            <div style="font-weight: bold; border-top: 1px solid #ccc; padding-top: 5px;">
                Wadarta Guud: <span id="receipt-total-price" style="float: right;">$0.00</span>
            </div>
            <p style="text-align: center; font-size: 0.9em; margin-top: 15px;">Fadlan sug xaqiijinta dalabkaaga. Waad mahadsan tahay!</p>
        </div>


        <div class="modal-actions">
            <button onclick="hideCustomAlert()" class="modal-ok-btn">OK</button>
        </div>
    </div>
</div>


<div class="checkout-bar" id="checkout-bar-menu" style="display: none;">
    <button class="checkout-btn" onclick="showPayment()">Checkout Now</button>
</div>

<div class="checkout-bar" id="checkout-bar-payment" style="display: none;">
    <button class="checkout-btn pay-btn" onclick="processPayment()">Dir Dalabka $0.00</button>
</div>


<script>
    // =======================================================
    // 0. AMMAANKA & DATABASE-KA TIJAABADA AH
    // =======================================================
    // User tusaale ah si aad u tijaabiso login-ka: email: user@test.com, password: password123
    let users = [
        { email: "user@test.com", password: "password123" } 
    ];
    let cart = {}; 
    let currentCartTotal = '$0.00'; 
    
    // =======================================================
    // 1. HELPER FUNCTIONS (NAVIGATION & ALERTS)
    // =======================================================
    const loginLandingSection = document.getElementById('login-landing-section');
    const loginSection = document.getElementById('login-section');
    const appHeader = document.getElementById('app-header');
    const menuSection = document.getElementById('menu-section');
    const paymentSection = document.getElementById('payment-section');
    const checkoutBarMenu = document.getElementById('checkout-bar-menu');
    const checkoutBarPayment = document.getElementById('checkout-bar-payment');
    const finalTotalSpan = document.getElementById('final-total');
    const finalPayBtn = document.querySelector('#checkout-bar-payment .pay-btn');
    const receiptDetailsContainer = document.getElementById('receipt-details-container');
    const modalActionsDiv = document.querySelector('.modal-actions');
    const modalOkBtn = document.querySelector('.modal-ok-btn');


    let isLoginMode = true; 

    // Custom Alert Functions
    function hideCustomAlert() {
        document.getElementById('custom-alert').style.display = 'none';
        receiptDetailsContainer.style.display = 'none';
        modalOkBtn.textContent = 'OK';
        modalOkBtn.onclick = function() { hideCustomAlert(); };
    }
    
    function showCustomAlert(title, message, isSuccess = false) {
        const titleElement = document.getElementById('alert-title');

        titleElement.textContent = title;
        document.getElementById('alert-message').innerHTML = message; 
        titleElement.style.color = isSuccess ? '#28a745' : '#dc3545';
        
        receiptDetailsContainer.style.display = 'none';
        
        document.getElementById('custom-alert').style.display = 'flex';
    }

    // Rasiidka Macmiilka (Customer Receipt)
    function showReceiptAlert(orderTotal) {
        const cartItemsDiv = document.getElementById('receipt-items-list');
        let html = '';

        for (const name in cart) {
            const item = cart[name];
            if (item.quantity > 0) {
                 html += `
                    <div style="display: flex; justify-content: space-between; font-size: 0.9em; padding: 3px 0;">
                        <span>${item.name || name} (${item.quantity}x)</span>
                        <span>$${(item.price * item.quantity).toFixed(2)}</span>
                    </div>
                `;
            }
        }
        
        cartItemsDiv.innerHTML = html;
        document.getElementById('receipt-total-price').textContent = orderTotal;
        
        showCustomAlert(
            '‚úÖ Dalabka Waa La Diray!', 
            'Si guul ah ayaa dalabkaaga loogu diray maamulka. Waxaan si degdeg ah kuu soo xiriiri doonaa.', 
            true 
        );
        
        receiptDetailsContainer.style.display = 'block';
    }

    function hideAllSections(hideHeader = false) {
        loginLandingSection.style.display = 'none';
        loginSection.style.display = 'none';
        menuSection.style.display = 'none';
        paymentSection.style.display = 'none';
        checkoutBarMenu.style.display = 'none';
        checkoutBarPayment.style.display = 'none';
        
        if(hideHeader) {
             appHeader.style.display = 'none';
        } else {
             appHeader.style.display = 'flex'; 
        }
    }

    function showLanding() {
        hideAllSections(true); 
        loginLandingSection.style.display = 'flex'; 
    }

    function showLogin(isLogin) {
        hideAllSections(true); 
        loginSection.style.display = 'flex'; 
        toggleAuth(isLogin); 
        window.scrollTo(0, 0); 
    }
    
    function showMenu() {
        hideAllSections(false); 
        menuSection.style.display = 'block';
        checkoutBarMenu.style.display = 'block';
        updateCartTotal(); // Hubi in total-ka la cusbooneysiiyay
        window.scrollTo(0, 0); 
    }
    
    function showPayment() {
        
        if (currentCartTotal === '$0.00') {
            showCustomAlert('üö´ Fadlan Dooro Alaab!', 'Ugu yaraan hal alaab ku dar gacanta alaabta ka hor inta aadan checkout samayn!');
            return; 
        }

        hideAllSections(false); 
        paymentSection.style.display = 'block';
        checkoutBarPayment.style.display = 'block';

        finalTotalSpan.textContent = currentCartTotal;
        finalPayBtn.textContent = `Dir Dalabka ${currentCartTotal}`;
        
        window.scrollTo(0, 0); 
    }
    
    // =======================================================
    // 2. AMMAANKA: EMAIL IYO PASSWORD VALIDATION
    // =======================================================
    
    function isValidEmail(email) {
        const regex = /\S+@\S+\.\S+/;
        return regex.test(email);
    }

    function toggleAuth(isLogin) {
        const loginTitle = document.getElementById('login-title');
        const toggleAuthText = document.getElementById('toggle-auth-text');
        const confirmPasswordGroup = document.getElementById('confirm-password-group');
        const submitLoginBtn = document.getElementById('submit-login-btn');
        
        isLoginMode = isLogin;
        if (isLogin) {
            loginTitle.textContent = 'Geli App-ka';
            submitLoginBtn.textContent = 'Geli App-ka';
            toggleAuthText.innerHTML = 'Ma haysaa Account? <span class="toggle-link" style="color: #28a745; cursor: pointer; font-weight: bold;" onclick="toggleAuth(false)">Diiwaangeli Hadda</span>';
            confirmPasswordGroup.style.display = 'none';
        } else {
            loginTitle.textContent = 'Diiwaangeli Account Cusub';
            submitLoginBtn.textContent = 'Diiwaangeli Account';
            toggleAuthText.innerHTML = 'Haddii aad Account leedahay? <span class="toggle-link" style="color: #28a745; cursor: pointer; font-weight: bold;" onclick="toggleAuth(true)">Geli Hadda</span>';
            confirmPasswordGroup.style.display = 'block';
        }
    }
    
    function processAuth() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        
        if (!isValidEmail(email)) {
            showCustomAlert('üö´ Khalad Xogta Email-ka!', 'Fadlan hubi in Email-ku uu sax yahay (tusaale: magac@domain.com).');
            return;
        }

        if (password.length < 6) {
            showCustomAlert('üö´ Khalad Xogta Password-ka!', 'Password-ku waa inuu ka koobnaadaa ugu yaraan 6 xaraf/nambaro.');
            return;
        }

        if (!isLoginMode) {
            const confirmPassword = document.getElementById('confirm-password').value;
            if (password !== confirmPassword) {
                showCustomAlert('üö´ Khalad Password-ka!', 'Labada Password isku mid ma ahan!');
                return;
            }
            
            const existingUser = users.find(user => user.email === email);
            if (existingUser) {
                showCustomAlert('üö´ Diiwaangelin hore!', 'Email-kan hore ayaa loo isticmaalay. Fadlan Login samee ama isticmaal Email kale.');
                return;
            }
            
            users.push({ email: email, password: password });
            showCustomAlert('‚úÖ Guul!', 'Account-kaaga waa la diiwaangeliyay. Hadda waad gali kartaa.', true);
            toggleAuth(true); 
            
        } else {
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                showCustomAlert('‚úÖ Guul!', 'Si guul ah ayaad u gashay App-ka. Ku soo dhawoow!', true);
                showMenu();
            } else {
                showCustomAlert('üö´ Khalad Gelitaan!', 'Email-ka ama Password-ku ma saxna. Fadlan isku day mar kale ama Diiwaangeli.');
            }
        }
    }

    // =======================================================
    // 3. DALABKA WAJIBKA AH & EMAIL GUDASHADA (MAILTO)
    // =======================================================
    
    function fillCardDetails() {
        // Tusaale buuxin simuleyshan oo card-ka ah
        const myCard = {
            number: "5291 8234 5359 8684", 
            expiry: "11/30",              
            cvv: "988",                   
            name: "MAXAMED AXMED"         
        };
        
        document.getElementById('card-number').value = myCard.number;
        document.getElementById('expiry-date').value = myCard.expiry;
        document.getElementById('cvv').value = myCard.cvv;
        document.getElementById('card-name').value = myCard.name;
        
        showCustomAlert(
            '‚úÖ Faahfaahinta Card-ka la Buuxiyay', 
            'Fadlan riix **Dir Dalabka** ee hoose si dalabkaaga loogu gudbiyo.', 
            true
        );
    }

    function processPayment() {
        const totalText = currentCartTotal; 
        
        // üö® EMAIL-KA LAGU DIRAYO DALABKA
        // Fadlan u beddel Email-kan midkaaga!
        const receivingEmail = 'maxamedaxamed153@gmail.com'; 
        // --------------------------------------------------------------------
        
        const provider = document.getElementById('mobile-provider').value;
        const cardNumber = document.getElementById('card-number').value.trim();
        const cardName = document.getElementById('card-name').value.trim();
        const expiryDate = document.getElementById('expiry-date').value.trim();

        const senderNum = document.getElementById('sender-mobile-number').value.trim();
        const senderName = document.getElementById('sender-name').value.trim();

        let paymentInfo = "‚ùå Habka Bixinta Lama Xaqiijin (Gacanta ku buuxi haddii ay meelna ka qornayn.)";
        let paymentIsValid = true;
        
        // 1. Xaqiijinta xogta lacag bixinta
        if (provider !== '' && senderNum !== '' && senderName !== '') {
             // Mobile Money la Doortay
            paymentInfo = `‚úÖ Mobile Money (Hubi Lacagta)\n`;
            paymentInfo += `   - Adeegga: ${provider}\n`;
            paymentInfo += `   - Nambarka Soo Diray: ${senderNum}\n`;
            paymentInfo += `   - Magaca Account-ka: ${senderName}\n`;
        } else if (cardNumber !== '' && cardName !== '' && expiryDate !== '') {
             // Card Payment la Doortay (Simulasyon)
             paymentInfo = `‚úÖ Card Payment (Hubi Bangiga)\n`;
             paymentInfo += `   - Nambarka Card-ka: ${cardNumber.slice(-4)} (4-ta u dambeeya)\n`;
             paymentInfo += `   - Magaca: ${cardName}\n`;
        } else if (provider === '' && cardNumber === '') {
            // Ma jiraan wax la doortay
            showCustomAlert('üö´ Khalad Bixinta!', 'Fadlan buuxi faahfaahinta Card-ka ama Mobile Money-ga.');
            paymentIsValid = false;
        } else {
             // Haddii ay meel wax ka dhiman yihiin oo uu mid doortay
             showCustomAlert('üö´ Khalad Xogta Bixinta!', 'Fadlan hubi in dhammaan faahfaahinta habka bixinta aad dooratay ay wada buuxan yihiin.');
             paymentIsValid = false;
        }

        if (!paymentIsValid) return; 
        
        
        // 2. Dhisida Fariinta Dalabka (Text Format)
        let orderDetails = "üõí DALAB CUSUB: MAHIGAN SHOPFY\n\n";
        orderDetails += `------------------------------------------------\n`;
        orderDetails += "--- XOGTA BIXINTA ---\n";
        orderDetails += paymentInfo + "\n";
        orderDetails += `------------------------------------------------\n`;
        orderDetails += `--- LIISKA ALAABTA ---\n`;
        
        let itemCounter = 1;
        for (const name in cart) {
            const item = cart[name];
            if (item.quantity > 0) {
                orderDetails += `${itemCounter}. ${name} - ${item.quantity}x @ $${item.price.toFixed(2)}\n`; 
                itemCounter++;
                // Sidoo kale ku dar magaca alaabta cart-ka si aan rasiidka ugu isticmaalno
                item.name = name; 
            }
        }
        
        // Ku dar Wadarta Guud
        orderDetails += `\n------------------------------------------------\n`;
        orderDetails += `üí∞ Wadarta Guud: ${totalText}`;
        orderDetails += `\n------------------------------------------------\n`;
        orderDetails += `\nFadlan hubi dalabkan degdeg.`;
        
        // 3. Xiriirinta Email-ka (Mailto:)
        // Hadda waa si toos ah (Silent Send)
        const encodedMessage = encodeURIComponent(`Fadlan Dalabkan Hoose:\n\n${orderDetails}`);
        const subject = encodeURIComponent(`Dalab Cusub MAHIGAN - ${totalText}`);
        
        const emailLink = `mailto:${receivingEmail}?subject=${subject}&body=${encodedMessage}`; 
        
        // Dir Email-ka si aamusan (wuxuu furayaa app-ka Email-ka)
        window.location.href = emailLink;
        
        // Tirtir cart-ka kadib dirista
        const orderTotalForReceipt = currentCartTotal;
        cart = {};
        updateCartTotal(); 
        showMenu(); // Ku soo celi bogga menu-ga
        
        // 4. MUUJINTA RASIDKA MACMIILKA
        showReceiptAlert(orderTotalForReceipt);
    }
    
    // =======================================================
    // 4. CART LOGIC 
    // =======================================================
    function displayCartItems() {
        const cartItemsDiv = document.getElementById('cart-items');
        let html = '';
        let isEmpty = true;

        for (const name in cart) {
            const item = cart[name];
            if (item.quantity > 0) {
                isEmpty = false;
                html += `
                    <div class="product-item cart-item">
                        <span style="font-weight: bold; color: #17a2b8; min-width: 20px;">${item.quantity}x</span> 
                        <div class="item-info" style="flex-grow: 1;">
                            <h3>${name}</h3>
                            <span class="price">$${(item.price * item.quantity).toFixed(2)}</span>
                        </div>
                        <div class="cart-item-controls">
                            <button class="add-to-cart-btn" style="background-color: #dc3545; margin-right: 5px;" onclick="decreaseQuantity('${name}')">-</button>
                            <button class="add-to-cart-btn" onclick="increaseQuantity('${name}')">+</button>
                        </div>
                    </div>
                `;
            }
        }

        if (isEmpty) {
            cartItemsDiv.innerHTML = '<p style="color: #777;">Wali maadan dooran wax alaab ah.</p>';
        } else {
            cartItemsDiv.innerHTML = html;
        }
    }

    function updateCartTotal() {
        let total = 0;
        for (const name in cart) {
            const item = cart[name];
            total += item.price * item.quantity;
        }
        const formattedTotal = total.toFixed(2);
        currentCartTotal = `$${formattedTotal}`;
        document.getElementById('total-price').textContent = currentCartTotal;
        
        displayCartItems();
    }
    
    function increaseQuantity(name) {
        if (cart[name]) {
            cart[name].quantity += 1;
        } else {
            const button = document.querySelector(`.add-to-cart-btn[data-product-name='${name}']`);
            if (button) {
                 const price = parseFloat(button.getAttribute('data-price'));
                 cart[name] = { price: price, quantity: 1 };
            }
        }
        updateCartTotal();
    }
    
    function decreaseQuantity(name) {
        if (cart[name] && cart[name].quantity > 0) {
            cart[name].quantity -= 1;
            if (cart[name].quantity === 0) {
                delete cart[name];
            }
            updateCartTotal();
        }
    }

    // Ku xir badhamada "Add to Cart" ee bogga Menu-ga
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            const name = this.getAttribute('data-product-name');
            const price = parseFloat(this.getAttribute('data-price'));

            if (cart[name]) {
                cart[name].quantity += 1;
            } else {
                cart[name] = { price: price, quantity: 1 };
            }
            updateCartTotal();
        });
    });


    updateCartTotal(); 
    showLanding(); 
</script>

</body>
</html>
